@using exam_proctor_system.Models.DTos.ResponseModel
@model IEnumerable<ExamResponseModel>
@section PageHead {
    <link rel="canonical" href="project-grid.html" />
    <link href="~/assets/libs/dropzone/dist/dropzone.css" rel="stylesheet " />

}

<section class="container-fluid p-4">
    <div class="row">
        <div class="col-lg-12 col-md-12 col-12">
            <!-- Page header -->
            <div class="border-bottom pb-3 mb-3 d-flex flex-column flex-md-row gap-3 align-items-md-center justify-content-between">
                <div class="d-flex flex-column gap-1">
                    <h1 class="mb-0 h2 fw-bold">Exams</h1>
                    <!-- Breadcrumb -->
                    
                </div>
                <!-- button -->
                <div>
                    <a href="project-grid.html#" class="btn btn-primary me-2" data-bs-toggle="offcanvas" data-bs-target="#offcanvasRight">Create an Exam</a>
                </div>
            </div>
        </div>
    </div>
    <!-- row -->
    <div class="row justify-content-md-between flex-md-row flex-column gap-1 gap-md-0 mb-4">
        <!-- col -->
        <div class="col-xl-2 col-lg-4 col-md-6 col-12">
            <!-- search -->
            <div>
                <input type="search" class="form-control" placeholder="Search by exam name " />
            </div>
        </div>
        <div class="col-xxl-2 col-lg-2 col-md-6 col-12">
            <!-- Custom select -->
            <select class="form-select" data-choices="">
                <option value="">Filter</option>
                <option value="In Progress">In Progress</option>
                <option value="Pending">Pending</option>
                <option value="Modified">Modified</option>
                <option value="Finished">Finished</option>
                <option value="Cancel">Cancel</option>
            </select>
        </div>
    </div>
    <div class="row gy-4">
        @foreach(var exam in Model){
            <div class="col-xxl-3 col-xl-4 col-lg-6 col-12">
                <!-- card -->
                <div class="card h-100">
                    <!-- card body -->
                    <div class="card-body">
                        <div class="d-flex flex-column gap-4">
                            <div class="d-flex flex-column gap-3">
                                <!-- heading-->
                                <div class="d-flex align-items-center justify-content-between">
                                    <!-- text-->

                                    <div>
                                        <h4 class="mb-0"><a href="project-grid.html#" class="text-inherit">@exam.Name</a></h4>
                                    </div>
                                    <!-- dropdown-->
                                    <div class="d-flex align-items-center">
                                        <div class="dropdown dropstart">
                                            <a href="project-grid.html#" class="btn-icon btn btn-ghost btn-sm rounded-circle" id="dropdownProjectOne" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                <i class="bi bi-three-dots-vertical"></i>
                                            </a>
                                            <div class="dropdown-menu" aria-labelledby="dropdownProjectOne">
                                                <span class="dropdown-header">Settings</span>
                                                <a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#editExamModal"
                                                   data-id="@exam.Id"
                                                   data-name="@exam.Name"
                                                   data-description="@exam.Description"
                                                   data-start="@exam.StartTime"
                                                   data-end="@exam.EndTime"
                                                   data-duration="@exam.Duration"
                                                   data-numberOfQuestions="@exam.NumberOfQuestions"
                                                   data-totalScore="@exam.TotalScore"
                                                   >
                                                    <i class="fe fe-edit dropdown-item-icon"></i>
                                                    Edit Details
                                                </a>


                                                <div class="dropdown-divider"></div>
                                                @* <a class="dropdown-item" href="project-grid.html#"> *@
                                                @*     <i class="fe fe-upload dropdown-item-icon"></i> *@
                                                @*     Download Questions *@
                                                @* </a> *@
                                                <div class="dropdown-divider"></div>
                                                @* <a class="dropdown-item" href="project-grid.html#"> *@
                                                @*     <i class="fe fe-trash dropdown-item-icon"></i> *@
                                                @*     Delete Project *@
                                                @* </a> *@
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-- para-->
                                <div class="">
                                    <p class="mb-0">@exam.Description</p>
                                </div>
                            </div>
                            <!-- progress -->
                            <div class="d-flex justify-content-between align-items-center mb-5">
                                <div class="d-flex align-items-center">
                                    <!-- avatar group -->
                                    <div class="avatar-group">
                                        <!-- avatar -->
                                        <span class="avatar avatar-md">
                                            <!-- img -->
                                            <img alt="avatar" src="~/assets/images/avatar/avatar-1.jpg" class="rounded-circle imgtooltip" data-template="one " />
                                            <span id="one" class="d-none">
                                                <small class="fw-semibold">Paul Haney</small>
                                            </span>
                                        </span>
                                        <!-- avatar -->
                                        <span class="avatar avatar-md">
                                            <!-- img -->
                                            <img alt="avatar" src="~/assets/images/avatar/avatar-2.jpg" class="rounded-circle imgtooltip" data-template="two " />
                                            <span id="two" class="d-none">
                                                <small class="fw-semibold">Gali Linear</small>
                                            </span>
                                        </span>
                                        <!-- avatar -->
                                        <span class="avatar avatar-md">
                                            <!-- img -->
                                            <img alt="avatar" src="~/assets/images/avatar/avatar-3.jpg" class="rounded-circle imgtooltip" data-template="three " />
                                            <span id="three" class="d-none">
                                                <small class="fw-semibold">Mary Holler</small>
                                            </span>
                                        </span>
                                        <!-- avatar -->
                                        <span class="avatar avatar-md">
                                            <!-- img -->
                                            <img alt="avatar" src="~/assets/images/avatar/avatar-4.jpg" class="rounded-circle imgtooltip" data-template="nordl" />
                                            <span id="nordl" class="d-none">
                                                <small class="fw-semibold">Lio Nordal</small>
                                            </span>
                                        </span>
                                        <!-- avatar -->
                                        <span class="avatar avatar-md">
                                            <span class="avatar-initials rounded-circle bg-light text-dark">5+</span>
                                        </span>
                                    </div>
                                </div>
                                <!-- text -->
                                <div>
                                    <span class="badge bg-info-soft">@exam.Status</span>
                                </div>
                            </div>
                        </div>
                        <div>
                            <!-- progress bar -->
                            <div class="progress progress-tooltip" style="height: 6px">
                                <div class="progress-bar bg-info" role="progressbar" style="width: @exam.Progress%" aria-valuenow="@exam.Progress" aria-valuemin="0" aria-valuemax="100">
                                    <span>@exam.Progress %</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- card footer -->
                    <div class="card-footer p-0">
                        <div class="d-flex justify-content-between">
                            <div class="w-50 py-3 px-4">
                                <h6 class="mb-0">Start Date:</h6>
                                <p class="text-dark fs-6 fw-semibold mb-0">@exam.StartTime</p>
                            </div>
                            <div class="border-start w-50 py-3 px-4">
                                <h6 class="mb-0">End Date:</h6>
                                <p class="text-dark fs-6 fw-semibold mb-0">@exam.EndTime</p>
                            </div>
                        </div>
                    </div>
                    <div class="text-center py-2">
                        <a href="@Url.Action("StreamExam", "Exams", new { examId = exam.Id })"
                           class="btn btn-primary btn-sm">
                            <i class="fe fe-video"></i> View Streams
                        </a>
                    </div>
                </div>
            </div>

        }
        
        <div class="col-xxl-3 col-xl-4 col-lg-6 col-12 mb-4">
            <a href="project-grid.html#" data-bs-toggle="offcanvas" data-bs-target="#offcanvasRight">
                <div class="card h-100 border border-2 shadow-none card-dashed-hover p-12">
                    <div class="card-body d-flex flex-column justify-content-center text-center">
                        <i class="fe fe-plus text-secondary mb-3 fs-2" aria-hidden="true"></i>
                    </div>
                </div>
            </a>
        </div>
    </div>
</section>
<!-- Offcanvas -->

<div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasRight" style="width: 600px">
    <div class="offcanvas-body" data-simplebar>
        <div class="offcanvas-header px-2 pt-0">
            <h3 class="offcanvas-title" id="offcanvasExampleLabel">Create Exam</h3>
            <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
        </div>
        <!-- card body -->
        <div class="container">
            <!-- form -->
            <form class="row needs-validation" asp-action="Create" enctype="multipart/form-data">
                <!-- form group -->
                <div class="mb-3 col-12">
                    <label class="form-label" for="projectTitle">
                        Exam Name
                        <span class="text-danger">*</span>
                    </label>
                    <input type="text" class="form-control" id="projectTitle" name="name" placeholder="Enter exam name" required />
                    <div class="invalid-feedback">Please enter exam name</div>
                </div>
                <!-- form group -->
                <div class="mb-3 col-12">
                    <label class="form-label" for="description">Description</label>
                    <textarea class="form-control" name="description" id="description" placeholder="Enter brief about exam..." rows="3" required></textarea>
                    <div class="invalid-feedback">Please enter project description</div>
                </div>
                <!-- form group -->
                <div class="mb-3 col-md-6 col-12">
                    <label class="form-label">
                        Start Date & Time
                        <span class="text-danger">*</span>
                    </label>
                    <div class="input-group me-3">
                        <input class="form-control flatpickr" type="text" name="startTime" placeholder="Select Date & Time" aria-describedby="basic-addon3" />

                        <span class="input-group-text" id="basic-addon3"><i class="fe fe-calendar"></i></span>
                    </div>
                </div>

                <!-- form group -->
                <div class="mb-3 col-md-6 col-12">
                    <label class="form-label">
                        End Date & Time
                        <span class="text-danger">*</span>
                    </label>
                    <div class="input-group me-3">
                        <input class="form-control flatpickr" type="text" name="endTime" placeholder="Select Date & Time" aria-describedby="basic-addon3" />

                        <span class="input-group-text" id="basic-addon3"><i class="fe fe-calendar"></i></span>
                    </div>
                </div>

               <!-- form group -->
                <div class="mb-3 col-md-6 col-12">
                    <label class="form-label">
                        Duration (in minutes)
                        <span class="text-danger">*</span>
                    </label>
                    <div class="input-group me-3">
                        <input class="form-control" name="duration" type="number"  aria-describedby="basic-addon2 " />
                    </div>
                </div>
                <!-- form group -->
                <div class="mb-3 col-md-6 col-12">
                    <label class="form-label">
                        Total Score
                        <span class="text-danger">*</span>
                    </label>
                    <div class="input-group me-3">
                        <input class="form-control" type="number" name="totalScore" aria-describedby="basic-addon3 " />
                    </div>
                </div>
               <div class="mb-3 col-md-6 col-12">
                    <label class="form-label">
                        Number of Questions
                        <span class="text-danger">*</span>
                    </label>
                    <div class="input-group me-3">
                        <input class="form-control" type="number" name="numberOfQuestions" aria-describedby="basic-addon3 " />
                    </div>
                </div>
               
                <div class="mb-3 col-md-6 col-12">
                    <div>
                        <!-- logo -->
                        <h5 class="mb-3">Exam Questions</h5>
                        <div class="icon-shape icon-xxl border rounded position-relative">
                            <span class="position-absolute"><i class="bi bi-image fs-3"></i></span>
                            <input class="form-control border-0 opacity-0" name="questions" accept=".csv, .xlsx" type="file" />
                        </div>
                    </div>
                </div>
                <div class="mb-3 col-md-6 col-12">
                    <div>
                        <a class="btn btn-primary" asp-action="QuestionTemplateDownload"
                           class="btn btn-info">
                            Download Template
                        </a>
                    </div>
                </div>
                <div class="col-md-8"></div>
                <!-- button -->
                <div class="col-12">
                    <button class="btn btn-primary" type="submit">Submit</button>
                    <button type="button" class="btn btn-outline-primary ms-2" data-bs-dismiss="offcanvas" aria-label="Close">Close</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Edit Exam Modal -->
<div class="modal fade" id="editExamModal" tabindex="-1" aria-labelledby="editExamModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
        <div class="modal-content" style="overflow-y: auto;overflow:hidden;">
            <form method="post" asp-action="Update" id="editExamForm" enctype="multipart/form-data">
                <div class="modal-header">
                    <h5 class="modal-title" id="editExamModalLabel">Edit Exam</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body row g-3">
                    <input type="hidden" name="id" id="editExamId" />
                    <div class="col-12">
                        <label class="form-label">Exam Name</label>
                        <input type="text" class="form-control" name="name" id="editExamName" required />
                    </div>
                    <div class="col-12">
                        <label class="form-label">Description</label>
                        <textarea class="form-control" name="description" id="editExamDescription" rows="3"></textarea>
                    </div>
                    <div class="col-md-6 col-12">
                        <label class="form-label">Start Date & Time</label>
                        <input class="form-control flatpickr" name="startTime" id="editStartTime" type="text" />
                    </div>
                    <div class="col-md-6 col-12">
                        <label class="form-label">End Date & Time</label>
                        <input class="form-control flatpickr" name="endTime" id="editEndTime" type="text" />
                    </div>
                    <div class="col-md-6 col-12">
                        <label class="form-label">Duration (in minutes)</label>
                        <input class="form-control" name="duration" id="editDuration" type="number" />
                    </div>

                    <!-- form group -->
                    <div class="mb-3 col-md-6 col-12">
                        <label class="form-label">
                            Total Score
                            <span class="text-danger">*</span>
                        </label>
                        <div class="input-group me-3">
                            <input class="form-control" type="number" name="totalScore" id="editTotalScore" aria-describedby="basic-addon3 " />
                        </div>
                    </div>
                    <div class="mb-3 col-md-6 col-12">
                        <label class="form-label">
                            Number of Questions
                            <span class="text-danger">*</span>
                        </label>
                        <div class="input-group me-3">
                            <input class="form-control" type="number" name="numberOfQuestions" id="editNumberOfQuestions" aria-describedby="basic-addon3 " />
                        </div>
                    </div>

                    <div class="mb-3 col-md-6 col-12">
                        <div>
                            <h5 class="mb-3">Exam Questions</h5>
                            <div class="icon-shape icon-xxl border rounded position-relative">
                                <span class="position-absolute"><i class="bi bi-image fs-3"></i></span>
                                <input class="form-control border-0 opacity-0" name="questions" accept=".csv, .xlsx" type="file" />
                            </div>
                        </div>
                    </div>
                    <div class="mb-3 col-md-6 col-12">
                        <div>
                            <a class="btn btn-primary" asp-action="QuestionTemplateDownload"
                               class="btn btn-info">
                                Download Template
                            </a>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-primary">Update Exam</button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                </div>
            </form>
        </div>
    </div>
</div>


@section Scripts{
    <script src="~/assets/libs/dropzone/dist/min/dropzone.min.js"></script>
    <script src="~/assets/libs/tippy.js/dist/tippy-bundle.umd.min.js"></script>
    <script src="~/assets/js/vendors/tooltip.js"></script>
    <script src="~/assets/js/vendors/dropzone.js"></script>
    <script src="~/assets/js/vendors/validation.js"></script>
    <script src="~/assets/libs/choices.js/public/assets/scripts/choices.min.js"></script>
    <script src="~/assets/js/vendors/choice.js"></script>
    <script>
             document.addEventListener("DOMContentLoaded", function () {
            flatpickr(".flatpickr", {
                enableTime: true,
                dateFormat: "Y-m-d H:i",
                time_24hr: true // Optional: Forces 24-hour format
            });
        });
        
    </script>
    <script>
        const editExamModal = document.getElementById('editExamModal');

        editExamModal.addEventListener('show.bs.modal', function (event) {
            const button = event.relatedTarget;

            // Get data attributes from clicked button
            const id = button.getAttribute('data-id');
            const name = button.getAttribute('data-name');
            const description = button.getAttribute('data-description');
            const start = button.getAttribute('data-start');
            const end = button.getAttribute('data-end');
            const duration = button.getAttribute('data-duration');
            const numberOfQuestions = button.getAttribute('data-numberOfQuestions');
            const totalScore = button.getAttribute('data-totalScore');

            // Set values in the modal
            document.getElementById('editExamId').value = id;
            document.getElementById('editExamName').value = name;
            document.getElementById('editExamDescription').value = description;
            document.getElementById('editStartTime').value = start;
            document.getElementById('editEndTime').value = end;
            document.getElementById('editDuration').value = duration;
            document.getElementById('editNumberOfQuestions').value = numberOfQuestions;
            document.getElementById('editTotalScore').value = totalScore;
        });
    </script>
}